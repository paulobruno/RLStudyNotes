\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{arrows,automata,plotmarks}
\usepackage{pgfplots}
\pgfplotsset{compat=1.15}

\tikzset{
    % node styles
    state-node/.style={
        fill=none, shape=circle, draw=black, thick, text=black, minimum size=0.6cm},
    action-node/.style={
        fill=black, draw=none, text=white, shape=circle, inner sep=0.05cm, minimum size=0.2cm},
    reward-node/.style={
        fill=none, draw=black, text=black},
    hidden-node/.style={
        fill=none, draw=none, text=white, shape=circle, inner sep=0,outer sep=0, minimum size=0.0cm},
    % label styles
    action-label/.style={
        shape=circle, text=white, draw=none, fill=black, inner sep=0.05cm, minimum size=0.2cm, align=center, yshift=0.0cm, anchor=center},
    reward-label/.style={
        shape=rectangle, text=black, draw=black, fill=white, minimum size=0.5cm, align=center, yshift=0.0cm, anchor=center},
    hidden-edge/.style={
        text=white, draw=none, fill=none, inner sep=0,outer sep=0, minimum size=0.0cm},
}


% Diagrama de interação
\newcommand{\rlinteraction}{
    \begin{tikzpicture}[->,>=latex, auto, node distance=2.0cm, very thick, font=\small]
        \tikzstyle{rect-node}=[fill=none,shape=rectangle,draw=black,text=black,rounded corners=0.1cm, inner sep=0.4cm]
        \tikzstyle{hidden-node}=[fill=none, draw=none, text=black, shape=rectangle, inner sep=0,outer sep=0.05cm, minimum height=0.75cm]
        
        \node[rect-node]  (Agent)                                     {\normalsize Agent};
        \node[rect-node]  (Env)     [below of=Agent]                  {\normalsize Environment};
        \node[hidden-node] (Hidden)  [left of=Env, xshift=-0.5cm]     {};
        \node[hidden-node] (UpHid)   [above of=Hidden, yshift=-1.0cm] {};
        \node[hidden-node] (DownHid) [below of=Hidden, yshift=1.0cm]  {};
        
        \draw[thick, transform canvas={yshift=0.25cm}] (Env) to node[above] 
            {$R_{t+1}$} (Hidden);
        \draw[ultra thick, transform canvas={yshift=-0.25cm}] (Env) to node[above] 
            {$S_{t+1}$} (Hidden);
        \draw[ultra thick] (Hidden.255) to node[left, pos=1.0, yshift=1.25cm, align=center] 
            {state\\$S_t$}  ++(-1.5,0) |- (Agent.165);
        \draw[thick] (Hidden.105) to node[right, pos=1.0, yshift=0.75cm, align=center] 
            {reward\\$R_t$} ++(-1.0,0) |- (Agent.195);
        \draw[ultra thick] (Agent) to node[below right, pos=1.0, yshift=-0.5cm, align=center] 
            {action\\$A_t$} ++(3.5,0)  |- (Env);
        \draw[-, thick, dashed] (UpHid) to node {} (DownHid);
    \end{tikzpicture}
}


\newcommand{\mdpthreestate}{
    \begin{tikzpicture}[->,>=stealth', auto, node distance=4.0cm, thick]
        \node[state-node]  (S1) {$s_1$};
        \node[state-node]  (S2) [below of=S1, xshift=-3.0cm] {$s_2$};
        \node[state-node]  (S3) [below of=S1, xshift= 3.0cm] {$s_3$};
        \node[action-node] (A1) [below of=S1, yshift=2.5cm, xshift=-3.0cm] {$a_1$};
        \node[action-node] (A2) [below of=S1, yshift=2.5cm]  {$a_2$};
        \node[action-node] (A3) [below of=S1, yshift=2.5cm, xshift=2.6cm] {$a_3$};
        
        \draw[bend right=20,-] (S1) to node[]  {} (A1);
        \draw[-]               (S1) to node[]  {} (A2);
        \draw[bend left=20,-] (S1) to node[]  {} (A3);
        
        \draw[bend right=30]   (A1) to node[left, pos=0.2]  {$p_1$} (S2);
        \draw[bend left=30]    (A1) to node[right, pos=0.2] {$p_2$} (S2);
        \draw[bend left=40]    (A2) to node[left, pos=0.3]  {$p_3$} (S2);
        \draw[bend right=40]   (A2) to node[right, pos=0.3] {$p_4$} (S3);
        \draw[bend left=20]    (A3) to node[] {} (S3);
        
        \draw[hidden-edge, bend right=30] (A1) to node[reward-label] {$r_1$} (S2);
        \draw[hidden-edge, bend left=30]  (A1) to node[reward-label] {$r_2$} (S2);
        \draw[hidden-edge, bend left=40]  (A2) to node[reward-label] {$r_3$} (S2);
        \draw[hidden-edge, bend right=40] (A2) to node[reward-label] {$r_4$} (S3);
        \draw[hidden-edge, bend left=20]  (A3) to node[reward-label] {$r_5$} (S3);
    \end{tikzpicture}
}


\newcommand{\mdpbig}{
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3.5cm, thick]
        \node[state-node] (S1)                     {$s_1$};
        \node[state-node] (S2) [above right of=S1] {$s_2$};
        \node[state-node] (S3) [below right of=S1, xshift=1.0cm] {$s_3$};
        \node[state-node] (S4) [below right of=S2] {$s_4$};
        \node[state-node] (S5) [right of=S4, xshift=-1.0cm]       {$s_5$};
        
        \node[action-node] (A1) [right of=S1, xshift=-2.0cm, yshift=0.5cm] {$a_1$};
        \node[action-node] (A3) [left of=S3, xshift=1.5cm, yshift=1.0cm] {$a_3$};
        \node[action-node] (A4) [below of=S4, xshift=0.75cm, yshift=2.0cm] {$a_4$};
        
        % from (S1)
        \draw[-] (S1) to node[] {} (A1);
        \draw[bend right=20] (A1) to node[left, pos=0.25] {$p_1$} (S2);
        \draw[bend left=20] (A1) to node[below, pos=0.25] {$p_2$} (S4);
        \draw[hidden-edge, bend right=20] (A1) to node[reward-label, pos=0.55] {$r_1$} (S2);
        \draw[hidden-edge, bend left=20] (A1) to node[reward-label, pos=0.60] {$r_2$} (S4);
        
        % from (S2)
        \draw[bend left=20] (S2) to node[action-label, pos=0.25] {$a_2$} (S4);
        \draw[hidden-edge, bend left=20] (S2) to node[reward-label, pos=0.65] {$r_3$} (S4);
        
        % from (S3)
        \draw[-, bend right=50] (S3) to node[] {} (A3);
        \draw[bend left=40] (A3) to node[above, pos=0.2] {$p_3$} (S1);
        \draw[bend right=40] (A3) to node[left, pos=0.3] {$p_4$} (S3);
        \draw[hidden-edge, bend left=40] (A3) to node[reward-label, pos=0.6] {$r_4$} (S1);
        \draw[hidden-edge, bend right=40] (A3) to node[reward-label, pos=0.6] {$r_5$} (S3);
        
        % from (S4)
        \draw[-] (S4) to node[] {} (A4);
        \draw[bend left=40] (A4) to node[left, pos=0.2] {$p_3$} (S3);
        \draw[bend right=40] (A4) to node[above, pos=0.25] {$p_4$} (S5);
        \draw[hidden-edge, bend left=40] (A4) to node[reward-label, left, pos=0.55] {$r_6$} (S3);
        \draw[hidden-edge, bend right=40] (A4) to node[reward-label, above right, pos=0.5] {$r_7$} (S5);
        
        % from (S5)
        \draw[bend right] (S5) to node[action-label, pos=0.25] {$a_5$} (S2);
        \draw[hidden-edge, bend right] (S5) to node[reward-label, pos=0.65] {$r_8$} (S2);
        
    \end{tikzpicture}
}

\begin{document}

\begin{center}
    \rlinteraction
\end{center}

\begin{center}
    \mdpthreestate
\end{center}

\begin{center}
    \mdpbig
\end{center}

\end{document}